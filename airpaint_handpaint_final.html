<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AirPaint â€“ Handtracking</title>
<style>
  body{margin:0; display:flex; flex-direction:column; height:100vh; background:#000; color:#fff; font-family:-apple-system, sans-serif;}
  header{padding:1rem; text-align:center; font-weight:600; background:#111;}
  #controls{display:flex; justify-content:center; gap:1rem; padding:.5rem; background:#222;}
  button{padding:.6rem 1rem; border-radius:.8rem; border:none; background:#007aff; color:#fff; font-weight:500;}
  button:disabled{background:#555;}
  #video{display:none;}
  #canvas{flex:1; width:100%; height:100%; background:#000;}
</style>
</head>
<body>
<header>AirPaint â€“ Malen in der Luft</header>
<div id="controls">
  <button id="startBtn">ðŸŽ¥ Kamera starten</button>
  <button id="switchBtn" disabled>ðŸ”„ Front/RÃ¼ck</button>
</div>
<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.min.js"></script>
<script>
const startBtn=document.getElementById("startBtn");
const switchBtn=document.getElementById("switchBtn");
const video=document.getElementById("video");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
let stream=null, useFront=true, lastPoint=null;

function resizeCanvas(){
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight - document.querySelector("header").offsetHeight - document.getElementById("controls").offsetHeight;
}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

async function startCamera(){
  if(stream) stream.getTracks().forEach(t=>t.stop());
  try{
    stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:useFront?"user":"environment"}, audio:false});
    video.srcObject=stream;
    video.onloadedmetadata=()=>{video.play(); processVideo();}
    switchBtn.disabled=false;
  }catch(e){alert("Kamera konnte nicht gestartet werden: "+e.message);}
}

function lineTo(x,y){
  ctx.lineWidth=6; ctx.lineCap="round"; ctx.lineJoin="round"; ctx.strokeStyle="#0a84ff";
  if(!lastPoint){ctx.beginPath(); ctx.moveTo(x,y);} ctx.lineTo(x,y); ctx.stroke(); lastPoint={x,y};
}

function pinch(lm){return Math.hypot(lm[4].x-lm[8].x,lm[4].y-lm[8].y)<0.05;}
function toCanvas(p){return {x:p.x*canvas.width, y:p.y*canvas.height};}

const hands=new Hands({locateFile:file=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
hands.setOptions({maxNumHands:1,modelComplexity:1,selfieMode:true,minDetectionConfidence:0.6,minTrackingConfidence:0.6});
hands.onResults(results=>{
  //ctx.clearRect(0,0,canvas.width,canvas.height); // optional, wenn vorherige Linien bestehen bleiben
  if(results.multiHandLandmarks && results.multiHandLandmarks.length){
    const lm=results.multiHandLandmarks[0];
    const pt=toCanvas(lm[8]);
    if(pinch(lm)) lineTo(pt.x,pt.y); else lastPoint=null;
    drawConnectors(ctx,lm,HAND_CONNECTIONS,{color:'#fff55',lineWidth:2});
    drawLandmarks(ctx,lm,{color:'#fff',lineWidth:1});
  }else lastPoint=null;
});

async function processVideo(){await hands.send({image:video}); requestAnimationFrame(processVideo);}

startBtn.onclick=startCamera;
switchBtn.onclick=()=>{useFront=!useFront; startCamera();}
</script>
</body>
</html>
